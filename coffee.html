
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Coffee and Restaurant Reviews</title>
  <style>
    body { font-family: sans-serif; margin: 2rem; background: #f5f5f5; }
    form, .review { background: #fff; padding: 1rem; margin-bottom: 2rem; border-radius: 5px; }
    input, textarea, button { display: block; width: 100%; margin-top: 0.5rem; padding: 0.5rem; }
    img { max-width: 200px; margin-top: 0.5rem; border-radius: 4px; }
    .review { border-left: 4px solid #333; }
  </style>
</head>
<body>
  <h1>Coffee Reviews ☕</h1>
  <form id="reviewForm">
    <label>Coffee Shop: <input type="text" name="shop" required /></label>
    <label>Location: <input type="text" name="location" required /></label>
    <label>Date Visited: <input type="date" name="date" required /></label>
    <label>Notes: <textarea name="notes" rows="3" required></textarea></label>
    <label>Rating (1–5): <input type="number" name="rating" min="1" max="5" required /></label>
    <label>Upload Image: <input type="file" name="image" accept="image/*" /></label>
    <button type="submit">Submit Review</button>
  </form>

  <section id="reviews">
    <h2>Recent Reviews</h2>
  </section>

  <script>
    const form = document.getElementById('reviewForm');
    const reviewsSection = document.getElementById('reviews');
    const apiURL = "https://script.google.com/macros/s/AKfycbyXg6ilSnT7-HpOp6kTE-PTlcNiGTaL4ipGxSKBg2cvSEbHCoId7bTMJFX_lICJaO3bVw/exec";

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const formData = new FormData(form);
      const imageFile = formData.get("image");
      let imageData = null, mimeType = "", fileName = "";

      if (imageFile && imageFile.size > 0) {
        const buffer = await imageFile.arrayBuffer();
        imageData = btoa(String.fromCharCode(...new Uint8Array(buffer)));
        mimeType = imageFile.type;
        fileName = imageFile.name;
      }

      const payload = {
        shop: formData.get("shop"),
        location: formData.get("location"),
        date: formData.get("date"),
        notes: formData.get("notes"),
        rating: formData.get("rating"),
        image: imageData,
        mimeType,
        filename: fileName
      };

      const response = await fetch(apiURL, {
        method: "POST",
        headers: { "Content-Type": "application/x-www-form-urlencoded" },
        body: new URLSearchParams(payload)
      });

      const result = await response.json();
      alert(result.result === "success" ? "Review submitted!" : "Error submitting review.");
      form.reset();
      loadReviews();
    });

    async function loadReviews() {
      const res = await fetch(apiURL);
      const data = await res.json();
      reviewsSection.innerHTML = "<h2>Recent Reviews</h2>";
      data.reverse().forEach(r => {
        const [shop, location, date, notes, rating, imgURL] = r;
        reviewsSection.innerHTML += `
          <div class="review">
            <h3>${shop} (${location})</h3>
            <p><strong>Date:</strong> ${date} | <strong>Rating:</strong> ${rating}</p>
            <p>${notes}</p>
            ${imgURL ? `<img src="${imgURL}" alt="Review Image" />` : ""}
          </div>`;
      });
    }

    loadReviews();
  </script>
</body>
</html>
